---
import { usePageSections } from '@@sf/layouts/use-page-main';
import BannersGrid from '~/components/BannersGrid.astro';
import ProductShelf from '~/components/ProductShelf.vue';
import Breadcrumbs from '~/components/Breadcrumbs.astro';
import DocDescription from '~/components/DocDescription.astro';

const { routeContext } = Astro.locals;
const { sections } = await usePageSections({
  routeContext,
  handleCustomSection: async (type, content) => {
    if (type === 'c:foo') return { props: { ...content, foo: 'bar' } };
    return { props: content };
  },
});
/* `apiContext` is surelly set here (from Wildcard.astro)
cause route resource is required to define sections from content. */
const { apiContext: { doc: apiDoc } } = routeContext;
---

<article class="my-9 md:my-12">
  {sections.map(async ({ type, props }) => {
    switch (type) {
      case 'product-shelf':
        return <ProductShelf {...props} client:visible />
      case 'banners-grid':
        return <BannersGrid {...props} />
      case 'breadcrumbs':
        return apiDoc && <Breadcrumbs {...props} apiDoc={apiDoc} />
      case 'doc-description':
        return apiDoc && <DocDescription apiDoc={apiDoc} />
      case 'c:foo':
        return <div data-foo={props.foo}></div>
      default:
        return <div data-section={type}></div>
    }
  })}
</article>
